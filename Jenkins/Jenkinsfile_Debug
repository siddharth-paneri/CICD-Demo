pipeline {
    agent any
    stages {
        stage('Bundle update') {
            steps {
                sh "sudo bundle install"
                sh "bundle update"
                sh "rvm use 2.6.5"
            }
        }
        stage('Increment Build Number') {
            steps {
                echo "Running ${env.BUILD_ID} on ${env.JENKINS_URL} at workspace: ${env.WORKSPACE}"
                sh "fastlane ios incrementBuildNumber"
            }
        }
        stage('Source Bash') {
            steps {
                sh "source ~/.bash_profile"
            }
        }
        stage('Environment check') {
            steps {
                sh "echo Gem Environement"
                sh "gem env"
                sh "echo Ruby Version"
                sh "ruby -v"
                sh "echo Which Ruby"
                sh "which ruby"
                sh "echo Which Fastlane"
                sh "which fastlane "
            }
        }
        /*
        stage('Build & Codesigning Debug ipa') {
            steps {
                sh "fastlane ios buildDebug"
            }
        }
        stage('Invoke Job 2') {
            steps {
                build job: 'oe-plus-ios-multi-job-2', wait: 'false'
            }
        }
        */

    }
    post {
        success {
            sh "echo Job1 succeeded"
        }
        failure {
            sh "echo Job2 failed"
        }
    }
}
